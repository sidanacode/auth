<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“ Location Picker | Firebase Auth</title>
  
  <!-- ğŸ¨ Beautiful CSS Styling -->
  <link rel="stylesheet" href="style.css">
  
  <!-- ğŸ”¥ Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
  <script src="firebase-config.js"></script>
  
  <!-- ğŸ—ºï¸ Google Maps API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFyDv8j7auqKfGVJiSJZmfcfFJgPXjIm8&libraries=geometry&callback=initMap"></script>
  
  <!-- ğŸ“± Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="location-container">
    <!-- ğŸ¯ Header Card -->
    <div class="card fade-in">
      <div class="card-header">
        <h1 class="card-title gradient-text">ğŸ“ Location Picker</h1>
        <p class="card-subtitle">Choose your location to complete registration</p>
      </div>

      <!-- ğŸ‘¤ User Information -->
      <div class="form-group">
        <label for="name" class="form-label">ğŸ‘¤ Your Name</label>
        <input 
          type="text" 
          id="name" 
          class="form-input" 
          placeholder="Enter your full name"
          autocomplete="name"
        >
        <input type="hidden" id="phone">
      </div>

      <!-- ğŸ“Œ Location Action -->
      <div class="form-group">
        <button 
          onclick="useCurrentLocation()" 
          class="btn btn-primary btn-full"
          id="locationBtn"
        >
          <span>ğŸ“Œ Use My Current Location</span>
        </button>
        <p style="text-align: center; color: var(--text-secondary); font-size: 0.875rem; margin-top: 8px;">
          Or click anywhere on the map below to select location
        </p>
      </div>
    </div>

    <!-- ğŸ—ºï¸ Map Container -->
    <div class="card fade-in map-container">
      <div id="map"></div>
    </div>

    <!-- ğŸ“Š Location Information Grid -->
    <div class="info-grid fade-in">
      <!-- ğŸŒ Coordinates Card -->
      <div class="info-card">
        <h4>ğŸŒ Coordinates</h4>
        <div class="info-item">
          <span class="info-label">Latitude</span>
          <span class="info-value" id="lat">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Longitude</span>
          <span class="info-value" id="lng">-</span>
        </div>
      </div>

      <!-- ğŸ  Address Details Card -->
      <div class="info-card">
        <h4>ğŸ  Address Details</h4>
        <div class="info-item">
          <span class="info-label">Full Address</span>
          <span class="info-value" id="address">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Street Number</span>
          <span class="info-value" id="street_number">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Street Name</span>
          <span class="info-value" id="street_name">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Neighborhood</span>
          <span class="info-value" id="neighborhood">-</span>
        </div>
      </div>

      <!-- ğŸŒ† Location Info Card -->
      <div class="info-card">
        <h4>ğŸŒ† Location Info</h4>
        <div class="info-item">
          <span class="info-label">City</span>
          <span class="info-value" id="city">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">State</span>
          <span class="info-value" id="state">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Country</span>
          <span class="info-value" id="country">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Postal Code</span>
          <span class="info-value" id="postal_code">-</span>
        </div>
      </div>

      <!-- ğŸ†” Google Maps Data Card -->
      <div class="info-card">
        <h4>ğŸ†” Maps Data</h4>
        <div class="info-item">
          <span class="info-label">Place ID</span>
          <span class="info-value" id="place_id">-</span>
        </div>
      </div>
    </div>

    <!-- ğŸ§¾ JSON Payload Display -->
    <div class="card fade-in">
      <h4 style="color: var(--primary-color); margin-bottom: 16px;">ğŸ§¾ JSON Payload</h4>
      <pre id="json_output" class="code-display">{}</pre>
    </div>

    <!-- ğŸ¬ Action Buttons -->
    <div class="card fade-in">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
        <!-- ğŸ’¾ Save to API Button -->
        <button 
          onclick="saveData()" 
          class="btn btn-success"
          id="saveBtn"
        >
          <span>ğŸ’¾ Save to API</span>
        </button>
        
        <!-- ğŸ‘¤ Get User Data Button -->
        <button 
          onclick="getUserData()" 
          class="btn btn-warning"
          id="getUserBtn"
        >
          <span>ğŸ‘¤ Get My Data</span>
        </button>
      </div>
    </div>

    <!-- ğŸ‘¤ User Data Display -->
    <div class="card fade-in">
      <h4 style="color: var(--primary-color); margin-bottom: 16px;">ğŸ‘¤ User Data from API</h4>
      <pre id="user_data_output" class="code-display">Click "Get My Data" to fetch your saved data</pre>
    </div>

    <!-- ğŸ” Security & Status Info -->
    <div class="card fade-in" style="text-align: center;">
      <div id="status-display" style="margin-bottom: 16px;"></div>
      <p style="color: var(--text-secondary); font-size: 0.875rem;">
        ğŸ” <strong>Secure API:</strong> All requests are authenticated with Firebase tokens.
        <br>ğŸŒ <strong>Privacy:</strong> Your location data is encrypted and securely stored.
      </p>
    </div>
  </div>

  <!-- ğŸ“± Enhanced JavaScript -->
  <script src="location.js"></script>
  
  <!-- âœ¨ Enhanced UI Interactions -->
  <script>
    // ğŸ¯ Enhanced UI interactions and loading states
    document.addEventListener('DOMContentLoaded', function() {
      const nameInput = document.getElementById('name');
      const saveBtn = document.getElementById('saveBtn');
      const getUserBtn = document.getElementById('getUserBtn');
      const statusDiv = document.getElementById('status-display');

      // ğŸ‘¤ Name input validation
      nameInput.addEventListener('input', function(e) {
        if (e.target.value.trim().length > 0) {
          e.target.style.borderColor = 'var(--success-color)';
        } else {
          e.target.style.borderColor = 'var(--border-color)';
        }
      });

      // ğŸ¨ Enhanced saveData function
      const originalSaveData = window.saveData;
      window.saveData = function() {
        saveBtn.classList.add('loading');
        saveBtn.disabled = true;
        saveBtn.innerHTML = '<span>ğŸ’¾ Saving...</span>';
        
        statusDiv.innerHTML = '<div class="status-indicator status-warning">â³ Saving data to API...</div>';
        
        try {
          originalSaveData();
        } catch (error) {
          saveBtn.classList.remove('loading');
          saveBtn.disabled = false;
          saveBtn.innerHTML = '<span>ğŸ’¾ Save to API</span>';
          statusDiv.innerHTML = '<div class="status-indicator status-error">âŒ Save failed</div>';
        }
      };

      // ğŸ¨ Enhanced getUserData function
      const originalGetUserData = window.getUserData;
      window.getUserData = function() {
        getUserBtn.classList.add('loading');
        getUserBtn.disabled = true;
        getUserBtn.innerHTML = '<span>ğŸ‘¤ Loading...</span>';
        
        statusDiv.innerHTML = '<div class="status-indicator status-warning">ğŸ” Fetching user data...</div>';
        
        try {
          originalGetUserData();
        } catch (error) {
          getUserBtn.classList.remove('loading');
          getUserBtn.disabled = false;
          getUserBtn.innerHTML = '<span>ğŸ‘¤ Get My Data</span>';
          statusDiv.innerHTML = '<div class="status-indicator status-error">âŒ Fetch failed</div>';
        }
      };
    });

    // ğŸ¯ Add success/error status updates
    window.addEventListener('load', function() {
      // Override alert function to show beautiful status messages
      const originalAlert = window.alert;
      window.alert = function(message) {
        const statusDiv = document.getElementById('status-display');
        
        if (message.includes('success') || message.includes('âœ…')) {
          statusDiv.innerHTML = '<div class="status-indicator status-success">' + message + '</div>';
          
          // Reset button states on success
          setTimeout(() => {
            const saveBtn = document.getElementById('saveBtn');
            const getUserBtn = document.getElementById('getUserBtn');
            
            if (saveBtn.disabled) {
              saveBtn.classList.remove('loading');
              saveBtn.disabled = false;
              saveBtn.innerHTML = '<span>ğŸ’¾ Save to API</span>';
            }
            
            if (getUserBtn.disabled) {
              getUserBtn.classList.remove('loading');
              getUserBtn.disabled = false;
              getUserBtn.innerHTML = '<span>ğŸ‘¤ Get My Data</span>';
            }
          }, 2000);
          
        } else if (message.includes('error') || message.includes('âŒ') || message.includes('âš ï¸')) {
          statusDiv.innerHTML = '<div class="status-indicator status-error">' + message + '</div>';
        } else {
          statusDiv.innerHTML = '<div class="status-indicator status-warning">' + message + '</div>';
        }
        
        // Also show original alert for important messages
        if (message.includes('name') || message.includes('location') || message.includes('authenticated')) {
          originalAlert(message);
        }
      };
    });
  </script>
</body>
</html>
